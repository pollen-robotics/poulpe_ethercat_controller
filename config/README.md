# Ethercat ESI configuration files

This directory contains the Ethercat Slave Information (ESI) files for the Ethercat slaves used in the project. The ESI files are used by the Ethercat master to configure the slaves. The ESI files are generated by the slave manufacturers and are specific to each slave.

The ESI files are stored in the `esi/` directory. 


## Python ESI generator
The directory contains a simple python esi file generator for orbita2d and orbita3d networks. It allows to create the files from the yaml files.
You can use it by running the following command:
```bash
cd esi_generator
python3 esi_from_yaml.py ../orbita2d.yaml # path to the yaml file
```
It generates the ESI files and saves it to the esi path given in the yaml file `ethercat>esi`.

You can also use the generator directly without the yaml file:

```python
from ethercat_esi_generator import *

# Generate XML for the master with two slaves
# 0: orbita 3d 
# 1: orbita 2d
tree_3d = generate_xml([3,2])
write_xml(tree_3d, "orbitas.xml")

print("XML files generated successfully.")
```


## Orbita Poulpe configuration - Flushing the EEPROM

The Orbita Poulpe slaves have an EEPROM that stores the configuration. If the EEPROM is not properly configured, the slaves will not work. To flush the EEPROM first we need to convert the ESI file to a binary file. This can be done using the `siitool` tool. 

for orbita2d
```bash
siitool orbita2d.xml orbita2d.bin
```
or for 3d
```bash
siitool orbita3d.xml orbita3d.bin
```
> You can install the `siitool` by following the instructions in the [siitool repository](https://github.com/synapticon/siitool)


Once you have the binary file, you can use the `ethercat` tool to flash the EEPROM. 

```bash
ethercat sii_write -p0 orbita2d.bin # may need sudo
```
Make sure to put the proper slave index `p0` is for slate 0, `p1` for slave 1, etc.
Also make sure to use the proper binary file, `orbita2d.bin` for orbita2d and `orbita3d.bin` for orbita3d.
